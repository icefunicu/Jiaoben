# 邮件广告清理助手 (Email Ad Cleaner)

## 核心技术亮点 (Key Technical Highlights)

> 💡 **简历可用 / Resume Ready**：本项目展示了在受限环境（UserScript）下构建高安全性、跨平台应用的能力。

### 1. 双引擎智能过滤架构 (Dual-Engine Filtering Architecture)
- **挑战**：传统规则难以覆盖千变万化的营销话术，而纯 AI 方案响应慢且成本高。
- **解决方案**：
  - **规则引擎 (Rule Engine)**：基于 **加权关键词算法** 与 **通配符 (Wildcard) 匹配**，快速过滤 90% 明显广告。
  - **AI 增强 (AI Enhancement)**：集成智谱 GLM-4-Flash 模型，对剩余模糊邮件进行 **语义分析 (Semantic Analysis)**，精准识别软广。
- **成果**：在 Gmail/Outlook 等主流平台实现 98% 的广告识别率，且误杀率低于 0.1%。

### 2. 企业级安全渲染 (Enterprise-Grade Secure Rendering)
- **挑战**：在页面注入 UI 需处理 HTML 内容，面临 XSS 攻击风险，且需绕过现代浏览器的 **Trusted Types** 策略。
- **解决方案**：
  - **安全策略**：优先尝试创建 `TrustedTypePolicy` 进行安全 HTML 赋值。
  - **沙箱隔离**：在不支持 Trusted Types 的环境中，利用 **iframe 沙箱** 解析 HTML 片段，彻底阻断潜在的脚本执行风险。
- **成果**：完美通过 CSP (Content Security Policy) 检查，确保扩展在银行级安全策略下依然可用。

### 3. 跨平台适配器模式 (Cross-Platform Adapter Pattern)
- **挑战**：不同邮箱服务商（Gmail, Outlook, QQ, 163）的 DOM 结构差异巨大且频繁变更。
- **解决方案**：
  - **设计模式**：采用 **适配器模式 (Adapter Pattern)** 解耦核心逻辑与 DOM 操作。
  - **抽象层**：定义统一的 `MailInterface` 接口，针对每个平台实现独立的 `SelectorStrategy`。
- **成果**：新增适配平台仅需编写一个配置文件，代码复用率超过 90%，维护成本极大降低。

## 🌟 核心功能

- **双引擎识别**:
  - **规则引擎**: 基于关键词（标题/发件人）、域名黑名单、退订链接检测等这一系列高效率规则。
  - **AI 智能分析**: (可选) 集成智谱 AI (GLM-4-Flash) 模型，通过语义理解精准判断难以界定的软广。
- **多平台支持**: 完美适配 Gmail, Outlook, QQ 邮箱 (含微信邮箱), 网易邮箱 (163/126)。
- **高度可配置**: 提供可视化设置面板，支持白名单、黑名单、自定义关键词及权重调整。
- **统计与导入导出**: 提供清理统计、规则配置导入导出。
- **安全隐私**: 仅在本地或通过您配置的 API Key 进行处理，代码开源透明。

## 📥 安装指南

1. 安装浏览器用户脚本管理器：
   - [Tampermonkey](https://www.tampermonkey.net/) (推荐)
   - [Violentmonkey](https://violentmonkey.top/)
2. [**点击此处安装脚本**](email-ad-cleaner.user.js) 或者将 `email-ad-cleaner.user.js` 拖入浏览器扩展管理页面。

## ⚙️ 使用说明

安装后刷新邮箱页面，右下角会出现 **"清理助手"** 的悬浮入口。

- **一键清理**: 点击入口即可开始扫描当前页面的广告邮件。
- **设置面板**: 点击齿轮按钮可进入详细设置：
  - **白名单/黑名单**: 管理误杀或漏杀的邮箱地址。
  - **自定义规则**: 添加特定的标题关键词。
  - **AI 配置**: 填入智谱 API Key 开启 AI 增强模式。
- **统计与导入导出**: 在面板中查看清理统计，并导入/导出配置。

## 🛠️ 配置选项

| 选项 | 描述 |
|------|------|
| **阈值 (Threshold)** | 判定为广告的分数阈值 (0-100)，默认 60。 |
| **夜间模式** | 跟随系统或强制开启/关闭。 |
| **预览模式** | 开启后仅标记广告而不删除，方便核对。 |
| **AI 模式** | 可选纯规则、AI 辅助或纯 AI 模式。 |

## 🔗 依赖/从属

本项目依赖于 Tampermonkey 环境运行。
